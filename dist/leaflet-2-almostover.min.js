!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("leaflet")):"function"==typeof define&&define.amd?define(["exports","leaflet"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).LeafletAlmostOver={},t.L)}(this,function(t,e){"use strict";function n(t){return!e.Util.isArray(t[0])||"object"!=typeof t[0][0]&&void 0!==t[0][0]}function s(t,n,s,i){const o=t.latLngToLayerPoint(n),a=t.latLngToLayerPoint(s),l=t.latLngToLayerPoint(i);return e.LineUtil.pointToSegmentDistance(o,a,l)}function i(t,n,s,i){let o=t.getMaxZoom();o===1/0&&(o=t.getZoom());const a=t.project(n,o),l=t.project(s,o),r=t.project(i,o),c=e.LineUtil.closestPointOnSegment(a,l,r);return t.unproject(c,o)}function o(t,n){const s=t.getLatLng(),i=t.getRadius(),o="number"==typeof i?i:i.radius,a=n.lng,l=n.lat,r=s.lng,c=s.lat,f=a-r,h=l-c,u=Math.sqrt(f*f+h*h),p=r+f/u*o,m=c+h/u*o;return new e.LatLng(m,p)}function a(t,o,l,r){let c,f,h,u,p,m=1/0,y=null;if(o instanceof Array){if(o[0]instanceof Array&&"number"!=typeof o[0][0]){for(f=0;f<o.length;f++)p=a(t,o[f],l,r),p&&p.distance<m&&(m=p.distance,y=p);return y}if(!(o[0]instanceof e.LatLng||"number"==typeof o[0][0]||"number"==typeof o[0].lat))return y;o=new e.Polyline(o)}if(!(o instanceof e.Polyline))return y;if(c=JSON.parse(JSON.stringify(o.getLatLngs().slice(0))),o instanceof e.Polygon){const t=function(e){if(n(e))e.push(e[0]);else for(let n=0;n<e.length;n++)t(e[n])};t(c)}if(n(c)){if(r){for(f=0,h=c.length;f<h;f++){const n=new e.LatLng(c[f]);u=this.distance(t,l,n),u<m&&(m=u,y=n,y.distance=u)}return y}for(f=0,h=c.length;f<h-1;f++){const n=new e.LatLng(c[f]),o=new e.LatLng(c[f+1]);u=s(t,l,n,o),u<=m&&(m=u,y=i(t,l,n,o),y.distance=u)}return y}for(f=0;f<c.length;f++)p=a(t,c[f],l,r),p.distance<m&&(m=p.distance,y=p);return y}function l(t,n,s){let i=1/0,r=null,c=null,f=1/0;for(let h=0,u=n.length;h<u;h++){const u=n[h];if(u instanceof e.LayerGroup){const e=l(t,u.getLayers(),s);e.distance<i&&(i=e.distance,r=e)}else u instanceof e.Circle?(c=o(u,s),f=this.distance(t,s,c)):"function"==typeof u.getLatLng?(c=u.getLatLng(),f=this.distance(t,s,c)):(c=a(t,u,s),c&&(f=c.distance)),f<i&&(i=f,r={layer:u,latlng:c,distance:f})}return r}function r(t,e,n,s=1/0,i=!0){const o=l(t,e,n);if(!o||o.distance>s)return null;if(i&&"function"==typeof o.layer.getLatLngs){const e=a(t,o.layer,o.latlng,!0);e.distance<s&&(o.latlng=e,o.distance=this.distance(t,e,n))}return o}e.Map.mergeOptions({almostOver:!0,almostDistance:25,almostSamplingPeriod:50,almostOnMouseMove:!0});class c extends e.Handler{initialize(t){this._map=t,this._layers=[],this._previous=null,this._marker=null,this._buffer=0,this._mouseMoveSampler=e.Util.throttle(this._onMouseMove,this._map.options.almostSamplingPeriod,this)}addHooks(){this._map.options.almostOnMouseMove&&this._map.on("mousemove",this._mouseMoveSampler,this),this._map.on("click dblclick",this._onMouseClick,this);const t=()=>{if(!this._map)return;const t=this._map.layerPointToLatLng([0,0]),e=this._map.layerPointToLatLng([this._map.options.almostDistance,this._map.options.almostDistance]);this._buffer=t.distanceTo(e)};this._map.on("viewreset zoomend",t,this),this._map.whenReady(t,this)}removeHooks(){this._map.off("mousemove",this._mouseMoveSampler,this),this._map.off("click dblclick",this._onMouseClick,this)}addLayer(t){"function"==typeof t.eachLayer?t.eachLayer(t=>this.addLayer(t),this):this._layers.push(t)}removeLayer(t){if("function"==typeof t.eachLayer)t.eachLayer(t=>this.removeLayer(t),this);else{const e=this._layers.indexOf(t);e>=0&&this._layers.splice(e,1)}this._previous=null}getClosest(t){const e=this._map.options.almostDistance;let n=this._layers;return r(this._map,n,t,e,!1)}_onMouseMove(t){if(!t.latlng)return;const n=this.getClosest(t.latlng);n?(this._previous?e.Util.stamp(this._previous.layer)!==e.Util.stamp(n.layer)&&(this._map.fire("almost:out",{layer:this._previous.layer}),this._map.fire("almost:over",{layer:n.layer,latlng:n.latlng})):this._map.fire("almost:over",{layer:n.layer,latlng:n.latlng}),this._map.fire("almost:move",{layer:n.layer,latlng:n.latlng})):this._previous&&this._map.fire("almost:out",{layer:this._previous.layer}),this._previous=n}_onMouseClick(t){const e=this.getClosest(t.latlng);e&&this._map.fire(`almost:${t.type}`,{layer:e.layer,latlng:e.latlng})}}e.Map.addInitHook("addHandler","almostOver",c),t.AlmostOverHandler=c});
//# sourceMappingURL=leaflet-2-almostover.min.js.map
